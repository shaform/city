<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="總是喜歡在自己的電腦上裝 Linux。小時候安裝還很麻煩，要燒光碟。後來研究了從硬碟安裝的方法，可又需要額外的磁區。一直到 USB 隨身碟普及了以後，重灌才成為一件比較方便的事。尤其 Ubuntu 的安裝界面做的還不錯，後來就一直用到今天。 雖然習慣使用 Linux，可是有時候還是會遇到要在 Windows ...">
        <meta name="keywords" content="Ubuntu 14.04, UEFI, Windows 8, Windows 8.1">
        <link rel="icon" href="http://city.shaform.com/favicon.ico">

        <title>在 UEFI 模式下同時安裝 Windows 8.1 和 Ubuntu 14.04 - 翼之都, City of Wings</title>

        <!-- Stylesheets -->
        <link href="http://city.shaform.com/theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="http://city.shaform.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="翼之都, City of Wings Full Atom Feed" />
        <link href="http://city.shaform.com/feeds/notes.atom.xml" type="application/atom+xml" rel="alternate" title="翼之都, City of Wings Categories Atom Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-13132274-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->

    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="http://city.shaform.com/"><img class="mr20" src="http://city.shaform.com/images/fly.png" alt="logo">翼之都, City of Wings</a>
                    </div>
                    <div class="nav pull-right">
                            <a href="http://city.shaform.com/category/ideas.html">Ideas</a>
                            <a href="http://city.shaform.com/category/notes.html">Notes</a>
                            <a href="http://city.shaform.com/category/projects.html">Projects</a>
                            <a href="http://city.shaform.com/tags.html">Tags</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">在 UEFI 模式下同時安裝 Windows 8.1 和 Ubuntu 14.04</h1>
                      <p class="header-date">By <a href="http://city.shaform.com/author/shaform.html">Shaform</a>, Thu 19 June 2014, in category <a href="http://city.shaform.com/category/notes.html">Notes</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="http://city.shaform.com/tag/ubuntu-1404.html">Ubuntu 14.04</a>, <a href="http://city.shaform.com/tag/uefi.html">UEFI</a>, <a href="http://city.shaform.com/tag/windows-8.html">Windows 8</a>, <a href="http://city.shaform.com/tag/windows-81.html">Windows 8.1</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>總是喜歡在自己的電腦上裝 Linux。小時候安裝還很麻煩，要燒光碟。後來研究了從硬碟安裝的方法，可又需要額外的磁區。一直到 USB 隨身碟普及了以後，重灌才成為一件比較方便的事。尤其 <a href="http://www.ubuntu.com/">Ubuntu</a> 的安裝界面做的還不錯，後來就一直用到今天。</p>
<p>雖然習慣使用 Linux，可是有時候還是會遇到要在 Windows 上才能寫的作業，所以每次都把電腦灌成雙系統，也慢慢熟悉了這個過程，一直以來不太有改變。不過最近拿到一台有 <a href="http://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface">UEFI</a> 開機的 Lenovo ThinkPad X1 Carbon 筆電，又想在啟用 Secure Boot 的情況下同時裝雙系統，設置上就比較麻煩了。本文就是記載這個過程。</p>
<h2>安裝 Windows 8</h2>
<p>原本如果是在正常的電腦上安裝 Windows 8，可以透過 <a href="http://www.microsoftstore.com/store/msusa/html/pbPage.Help_Win7_usbdvd_dwnTool">Windows USB/DVD download tool</a> 來製作安裝用隨身碟，但在 UEFI 啟用的情況下就不行了。這時參考<a href="http://social.msdn.microsoft.com/Forums/en-US/e7ed293e-b565-44ee-a536-166dddf32205/how-to-create-windows-8-installation-bootable-usb-for-uefi-samsung-slate">〈How to create Windows 8 installation bootable USB for UEFI〉</a>，首先在 Windows 環境下使用管理員權限執行 cmd.exe，用 diskpart.exe 找出隨身碟的代號：</p>
<div class="highlight"><pre><span></span>diskpart.exe
list disk
</pre></div>


<p>再把隨身碟格式化成 FAT32，並設成可開機。注意，<code>disk 1</code> 的這個 <code>1</code> 要選擇隨身碟代號，否則可能會把其他硬碟的內容給刪除。<code>partition 1</code> 則指的是隨身碟上的第一個 partition：</p>
<div class="highlight"><pre><span></span>select disk 1
clean
create partition primary
select partition 1
active
format quick fs=fat32
assign
<span class="k">exit</span>
</pre></div>


<p>理論上用其他工具格式化隨身碟可能也可以，不過沒有嘗試過。</p>
<p>接下來，先 mount Windows 8 的安裝光碟，然後把內容全部拷貝到隨身碟上，比如說如果安裝光碟 mount 在 <code>H:</code>，而隨身碟在 <code>F:</code> 的話：</p>
<div class="highlight"><pre><span></span>xcopy H:\* F:\ /s /e
</pre></div>


<p>然後先用 BIOS 停用 UEFI Secure Boot，才能用隨身碟開機。首先開始安裝 Windows 8。參考 <a href="http://www.techrepublic.com/blog/windows-and-office/the-complete-guide-to-a-windows-8-clean-installation/">〈The complete guide to a Windows 8 clean installation〉</a> 進行安裝，但自行設定硬碟磁區大小，空出給 Ubuntu 的空間。此時安裝程式也會自動幫你建立 Recovery, System (Reserved), MSR (EFI 磁區) 等三個磁區，看起來很醜，不過可能有用，就保留吧。</p>
<p>裝完後不知為什麼時間設定有錯，而且也無法更新，於是參考<a href="http://www.trishtech.com/2013/03/change-time-servers-in-windows-8/">〈Change Time Servers in Windows 8〉</a>，將 time server 改成台大的 <code>ntp2.ntu.edu.tw</code>。</p>
<p>最後重開機，在 BIOS 中啟用 UEFI Secure Boot 就大功告成了。</p>
<h2>安裝 Windows 8.1</h2>
<p>假設直接用 Windows 8.1 安裝光碟，到這裡就結束了。可是因為學校只有升級版的 Windows 8.1，所以緊接著馬上從 Windows 8 升級到 Windows 8.1。</p>
<p>首先用 Windows Update 更新系統，然後 mount Windows 8.1 光碟，並執行他。開始一步步安裝，安裝的選項跟 Windows 8 差不多，我選擇不要保留任何設定，把 Windows 8 的紀錄都洗掉。安裝完硬碟又會多一個 Recovery 磁區，雖然很醜，可是可能有用所以保留他。</p>
<p>安裝完後再重新設定一次 time server 就大功告成了！</p>
<h2>安裝 Ubuntu 14.04 64-bit</h2>
<p>只有 64-bit 版本對 UEFI 有較好的支援，所以首先參考<a href="http://www.ubuntu.com/download/desktop/create-a-usb-stick-on-ubuntu">〈How to create a bootable USB stick on Ubuntu〉</a>製作一個 Ubuntu 14.04 安裝隨身碟，然後參考<a href="https://help.ubuntu.com/community/UEFI">〈Ubuntu Community Wiki: UEFI〉</a>來安裝，基本上安裝過程跟一般情形一樣，只是我選擇自訂磁碟分割，所以要自己找出 EFI 磁區，然後指定 mount 到 <code>/boot/efi</code>。</p>
<p>最後裝完會遇到一個 bug：<a href="https://bugs.launchpad.net/ubuntu/+source/grub2/+bug/1091464">〈Unable to chainload Windows 8 with Secure Boot enabled
〉</a>，使得無法直接用 grub2 來啟動 Windows 8.1，不過 ThinkPad X1 Carbon 可以透過 BIOS 來多重開機，因此還是可以使用，對於很少使用 Windows 8.1 的我來說並不造成困擾。</p>


            <div class="comments">
                <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        var disqus_shortname = 'cityofwings';
                        var disqus_identifier = 'blog/2014/06/19/install-w8-ubuntu-with-uefi.html';
                        var disqus_url = 'http://city.shaform.com/blog/2014/06/19/install-w8-ubuntu-with-uefi.html';
                        (function() {
                            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                <noscript>Please enable JavaScript to view the comments.</noscript>
            </div>
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="http://city.shaform.com/archives.html">Archives</a></li>
                            <li><a href="http://city.shaform.com/tags.html">Tags</a></li>
                            <li><a href="http://city.shaform.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="https://github.com/shaform" target="_blank">GitHub</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="http://shaform.wordpress.com" target="_blank">一座島</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; shaform 2015</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>