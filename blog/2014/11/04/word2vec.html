<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="最近因為一些學習上的需要接觸了 word2vec，覺得好像是有點神秘的東西。一般初學自然語言處理的時候，處理文字最簡單的模型就是把每個詞當作一個單位，比如說用個 id 來表示他。然後再去算詞與詞之間的統計關係。或者是利用句子的文法結構來進行其他處理。如果把每個詞出現的次數當作一個維度的話，也可以把句子或文件用一個向量來表示。 不過 word2vec...">
        <meta name="keywords" content="Chinese, jieba, python, word2vec">
        <link rel="icon" href="http://city.shaform.com/favicon.ico">

        <title>用中文資料測試 word2vec - 翼之都, City of Wings</title>

        <!-- Stylesheets -->
        <link href="http://city.shaform.com/theme/css/all.min.css" rel="stylesheet">
        <link href="/style/style.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="http://city.shaform.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="翼之都, City of Wings Full Atom Feed" />
        <link href="http://city.shaform.com/feeds/notes.atom.xml" type="application/atom+xml" rel="alternate" title="翼之都, City of Wings Categories Atom Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-13132274-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->

    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="http://city.shaform.com/"><img class="mr20" src="http://city.shaform.com/images/fly.png" alt="logo">翼之都, City of Wings</a>
                    </div>
                    <div class="nav pull-right">
                            <a href="http://city.shaform.com/category/ideas.html">Ideas</a>
                            <a href="http://city.shaform.com/category/notes.html">Notes</a>
                            <a href="http://city.shaform.com/category/projects.html">Projects</a>
                            <a href="http://city.shaform.com/tags.html">Tags</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">用中文資料測試 word2vec</h1>
                      <p class="header-date">By <a href="http://city.shaform.com/author/shaform.html">Shaform</a>, Tue 04 November 2014, in category <a href="http://city.shaform.com/category/notes.html">Notes</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="http://city.shaform.com/tag/chinese.html">Chinese</a>, <a href="http://city.shaform.com/tag/jieba.html">jieba</a>, <a href="http://city.shaform.com/tag/python.html">python</a>, <a href="http://city.shaform.com/tag/word2vec.html">word2vec</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>最近因為一些學習上的需要接觸了 <a href="https://code.google.com/p/word2vec/">word2vec</a>，覺得好像是有點神秘的東西。一般初學自然語言處理的時候，處理文字最簡單的模型就是把每個詞當作一個單位，比如說用個 id 來表示他。然後再去算詞與詞之間的統計關係。或者是利用句子的文法結構來進行其他處理。如果把每個詞出現的次數當作一個維度的話，也可以把句子或文件用一個向量來表示。</p>
<p>不過 word2vec 是把每個詞本身用一個多維向量來表示，把詞投影到一個向量空間裡。而且不知道為什麼投影出來的空間有些特殊的性質，比如說相同屬性的詞可能會靠得很近，甚至部份的向量有邏輯上的線性關係等等：</p>
<p>vector('King') - vector('Man') + vector('Woman') ~= vector('Queen')</p>
<p>這份筆記紀錄了使用 word2vec 處理中文資料的小小實驗。</p>
<h2>語料</h2>
<p>不太確定有什麼開放的中文語料可供使用，於是決定先用<a href="https://github.com/audreyt/moedict-webkit">萌典</a>來做實驗，可按照教學，下載萌典資料：</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">git clone --depth <span class="m">1</span> https://github.com/g0v/moedict-data.git
</span><span class="hll">git clone --depth <span class="m">1</span> https://github.com/g0v/moedict-epub.git
</span><span class="hll">cp -v moedict-data/dict-revised.json moedict-epub/
</span><span class="hll"><span class="nb">cd</span> moedict-epub
</span><span class="hll">perl json2unicode.pl &gt; dict-revised.unicode.json
</span></pre></div>


</div>
<p>緊接著我自己寫了一個 <a href="https://github.com/shaform/experiments/blob/master/word2vec_tw/extract_json.py">extract_json.py</a> 把當中可供訓練的句子抽出來：</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">python3 extract_json.py &lt; dict-revised.unicode.json &gt; sentences.txt
</span></pre></div>


</div>
<h2>斷詞</h2>
<p>因為 word2vec 的輸入必須是以空白隔開的詞，這樣得出來的句子還不能直接使用。於是我用了結巴斷詞，寫了一個 <a href="https://github.com/shaform/experiments/blob/master/word2vec_tw/cut.py">cut.py</a> 來處理這些句子。</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">python cut.py &lt; sentences.txt &gt; sentences.segged.txt
</span></pre></div>


</div>
<p>斷出來的結果大約像是：</p>
<div class="highlight"><pre><span></span>紅樓夢 ． 第十七回 ： 「 一 槅 一 槅 ， 或 有 貯書處 ， 或 有 設鼎處 ， 或 安置 筆硯 處 ， 或供 設瓶花 、 或 安放 盆景 處 。 」
</pre></div>


<p>感覺雖不是很理想，但尚可接受。</p>
<h2>使用 word2vec 訓練詞向量</h2>
<p>接著我就用工作站把詞全部丟給 word2vec 訓練：</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">./word2vec -train sentences.segged.txt -output vectors.bin -cbow <span class="m">0</span> -size <span class="m">200</span> -window <span class="m">10</span> -negative <span class="m">5</span> -hs <span class="m">0</span> -sample 1e-4 -threads <span class="m">24</span> -binary <span class="m">1</span> -iter <span class="m">20</span> -min-count <span class="m">1</span>
</span></pre></div>


</div>
<p>因為萌典抽出來的資料不算多，所以訓練起來滿快的，只是當然效果就不太好了：</p>
<p><img alt="word2vec running..." src="http://city.shaform.com/images/train_word2vec.png"></p>
<h2>測試</h2>
<p>首先測試距離相近的字：</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">./distance vectors.bin
</span></pre></div>


</div>
<p>雖然效果差強人意，不過還是可以看到相同屬性的字確實有些群聚效應：</p>
<div class="highlight"><pre><span></span>Enter word or sentence (EXIT to break): 法國

Word: 法國  Position in vocabulary: 992

                                            Word         Cosine distance
------------------------------------------------------------------------
                                            英國         0.763948
                                            德國         0.727664
                                          義大利         0.724732
                                            瑞士         0.724247
                                          西班牙         0.715528
                                          奧地利         0.696855
                                          蘇格蘭         0.689557
</pre></div>


<p>接著測試線性關係，A 比 B 就好像 C 比什麼？：</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">./word-analogy vectors.bin
</span></pre></div>


</div>
<p>對於國家與都市的推理，也稍有效果：</p>
<div class="highlight"><pre><span></span>Enter three words (EXIT to break): 法國 巴黎 英國

Word: 法國  Position in vocabulary: 992

Word: 巴黎  Position in vocabulary: 6379

Word: 英國  Position in vocabulary: 822

                                            Word         Distance
------------------------------------------------------------------------
                                            倫敦         0.583572
                                          七二年         0.576999
                                          莫斯科         0.566673
                                          四四年         0.566332
                                      一九四一年         0.562817
                                          芝加哥         0.559529
                                      一九六二年         0.556010
                                          羅浮宮         0.555593
                                          油畫院         0.554334
</pre></div>


<p>訓練出來的詞向量或許可以供進一步利用，只是在實際使用之前無法確定是否適用於特定的應用。</p>
<h2>程式碼</h2>
<p>我把相關的程式碼放在 GitHub 上面供參考：<a href="https://github.com/shaform/experiments/tree/master/word2vec_tw">https://github.com/shaform/experiments/tree/master/word2vec_tw</a></p>
<h2>參考資料</h2>
<ol>
<li><a href="https://code.google.com/p/word2vec/">word2vec</a></li>
<li><a href="http://www.cnblogs.com/hebin/p/3507609.html">利用中文数据跑Google开源项目word2vec</a></li>
<li><a href="http://blog.fukuball.com/ru-he-shi-yong-jieba-jie-ba-zhong-wen-fen-ci-cheng-shi/">如何使用 JIEBA 結巴中文分詞程式</a></li>
</ol>


            <div class="comments">
                <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        var disqus_shortname = 'cityofwings';
                        var disqus_identifier = 'blog/2014/11/04/word2vec.html';
                        var disqus_url = 'http://city.shaform.com/blog/2014/11/04/word2vec.html';
                        (function() {
                            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                <noscript>Please enable JavaScript to view the comments.</noscript>
            </div>
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="http://city.shaform.com/archives.html">Archives</a></li>
                            <li><a href="http://city.shaform.com/tags.html">Tags</a></li>
                            <li><a href="http://city.shaform.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="https://github.com/shaform" target="_blank">GitHub</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="http://shaform.com" target="_blank">About me</a></li>
                            <li><a href="http://shaform.wordpress.com" target="_blank">一座島</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; shaform 2015</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>