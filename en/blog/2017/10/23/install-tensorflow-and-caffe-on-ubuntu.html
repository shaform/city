<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Previously I have written about 在Ubuntu 安裝 TensorFlow 的紀錄 (Installing TensorFlow on Ubuntu). Years have passed, and even though Ubuntu is still on 16.04，TensorFlow has already made great progress....">
        <meta name="keywords" content="Caffe, CUDA, TensorFlow, Ubuntu">
        <link rel="icon" href="https://city.shaform.com/en/favicon.ico">

        <title>Install TensorFlow and Caffe on Ubuntu 16.04 with Anaconda - City of Wings</title>

        <!-- Stylesheets -->
        <link href="https://city.shaform.com/en/theme/css/all.min.css" rel="stylesheet">
        <link href="/style/style.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://city.shaform.com/en/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="City of Wings Full Atom Feed" />
        <link href="https://city.shaform.com/en/feeds/notes.atom.xml" type="application/atom+xml" rel="alternate" title="City of Wings Categories Atom Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-13132274-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->


    </head>

    <body>

        <!-- Header -->
    <div class="header-container" style="background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url('https://city.shaform.com/en/images/background.jpg'); background-position: center; background-size: cover;">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://city.shaform.com/en/"><img class="mr20" src="https://city.shaform.com/en/images/fly.png" alt="logo">City of Wings</a>
                    </div>
                    <div class="nav pull-right">
                                <a href="https://city.shaform.com/en/category/ideas.html">Ideas</a>
                                <a href="https://city.shaform.com/en/category/notes.html">Notes</a>
                                <a href="https://city.shaform.com/en/category/projects.html">Projects</a>
                                <a href="https://city.shaform.com/en/tags.html">Tags</a>
                            <a href="https://city.shaform.com">- zh -</a>
  
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">Install TensorFlow and Caffe on Ubuntu 16.04 with Anaconda</h1>
                      <p class="header-date">By <a href="https://city.shaform.com/en/author/shaform.html">Shaform</a>, Mon 23 October 2017, in category <a href="https://city.shaform.com/en/category/notes.html">Notes</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="https://city.shaform.com/en/tag/caffe.html">Caffe</a>, <a href="https://city.shaform.com/en/tag/cuda.html">CUDA</a>, <a href="https://city.shaform.com/en/tag/tensorflow.html">TensorFlow</a>, <a href="https://city.shaform.com/en/tag/ubuntu.html">Ubuntu</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>Previously I have written about <a href="https://city.shaform.com/en/../blog/2016/10/31/install-tensorflow-with-cuda.html">在Ubuntu 安裝 TensorFlow 的紀錄 (Installing
TensorFlow on Ubuntu)</a>.  Years have passed, and even though
Ubuntu is still on 16.04，TensorFlow has
already made great progress.  I've decided to write another post to show how to
install TensorFlow and Caffe with Anaconda.</p>
<h2>GPU Settings</h2>
<h3>Basic</h3>
<p>Firstly set integrated video card as the main GPU in the BIOS, and connect your
monitor to the output port of the integrated video card so your Nvidia GPU is
completely dedicated to deep learning computation.</p>
<h3>Install CUDA</h3>
<p>Afterwards, download the deb files from <a href="https://developer.nvidia.com/cuda-downloads">the download page of
CUDA</a>.  Do not install at this time. We would reboot Ubuntu and
enter <code>Ctrl-Alt-F1</code> to login via terminal.</p>
<p>Execute the following command to stop <code>lightdm</code>.</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">sudo service lightdm stop
</span></pre></div>


</div>
<p>According to <a href="https://gist.github.com/bearpaw/c38ef18ec45ba6548ec0">this article</a>, this must be done when you want to
use your Nvidia GPU solely for CUDA. When this is not done, we might not be
able to login to the desktop after CUDA installation.</p>
<p>So now we would install CUDA 8.0.</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">sudo dpkg -i cuda-repo-&lt;distro&gt;_&lt;version&gt;_&lt;architecture&gt;.deb
</span><span class="hll">sudo apt update
</span><span class="hll">sudo apt install cuda-8-0
</span></pre></div>


</div>
<p>Record which version of nvidia driver is installed and add the PATH to <code>.bashrc</code>:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64:/usr/lib/nvidia-384
<span class="nb">export</span> <span class="nv">CUDA_HOME</span><span class="o">=</span>/usr/local/cuda
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/cuda/bin
</pre></div>


<p>where <code>/usr/lib/nvidia-384</code> should point to the actual version installed.</p>
<p>Reboot again to confirm that we could login:</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">sudo reboot
</span></pre></div>


</div>
<h2>Setup Anaconda Environment</h2>
<h3>Install Anaconda</h3>
<p>Download Python 3 version of Anaconda at the <a href="https://www.anaconda.com/download/#linux">Anaconda download
page</a>, and execute the installation command:</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">bash ~/Downloads/Anaconda3-<span class="o">{</span>VERSION<span class="o">}</span>-Linux-x86_64.sh
</span></pre></div>


</div>
<p>Install Anaconda onto a directory such as <code>$HOME/anaconda3</code>.</p>
<h3>Create TensorFlow Environment</h3>
<p>Activate Anaconda:</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll"><span class="nb">source</span> <span class="nv">$HOME</span>/anaconda3/bin/activate
</span></pre></div>


</div>
<p>And create a new environment named <code>tf</code>:</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">conda create -n tf anaconda
</span></pre></div>


</div>
<p>Finally activate <code>tf</code> environment:</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll"><span class="nb">source</span> activate tf
</span></pre></div>


</div>
<h2>Install TensorFlow</h2>
<p>Execute this command and <code>tensorflow-gpu</code>, <code>cudnn</code>, <code>cudatoolkit</code> would be
installed automatically.
<div class="sh-highlight" markdown="1"></p>
<div class="highlight"><pre><span></span><span class="hll">conda install tensorflow-gpu
</span></pre></div>


</div>

<h2>Install Caffe</h2>
<p>Firstly install the required packages:</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">sudo apt install build-essential
</span><span class="hll">conda install atlas boost gflags glog hdf5 leveldb lmdb openblas protobuf
</span><span class="hll">conda install -c menpo opencv3
</span></pre></div>


</div>
<p>Download Caffe, and create the configuration file.</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">git clone https://github.com/BVLC/caffe
</span><span class="hll"><span class="nb">cd</span> caffe
</span><span class="hll">cp Makefile.config.example Makefile.config
</span></pre></div>


</div>
<p>Modify <code>Makefile.config</code>, the number in <code>python3.6</code> could be
changed to the current Python version:</p>
<div class="highlight"><pre><span></span>5c5
<span class="o">&lt;</span> # USE_CUDNN := 1
<span class="gd">---</span>
<span class="o">&gt;</span> USE_CUDNN := 1
21c21
<span class="o">&lt;</span> # OPENCV_VERSION := 3
<span class="gd">---</span>
<span class="o">&gt;</span> OPENCV_VERSION := 3
25c25
<span class="o">&lt;</span> # CUSTOM_CXX := g++
<span class="gd">---</span>
<span class="o">&gt;</span> CUSTOM_CXX := /usr/bin/g++-4.9
68,69c68,69
<span class="o">&lt;</span> PYTHON_INCLUDE := /usr/include/python2.7 \
<span class="o">&lt;</span>       /usr/lib/python2.7/dist-packages/numpy/core/include
<span class="gd">---</span>
<span class="o">&gt;</span> # PYTHON_INCLUDE := /usr/include/python2.7 \
<span class="o">&gt;</span> #         /usr/lib/python2.7/dist-packages/numpy/core/include
72,75c72,75
<span class="o">&lt;</span> # ANACONDA_HOME := $(HOME)/anaconda
<span class="o">&lt;</span> # PYTHON_INCLUDE := $(ANACONDA_HOME)/include \
<span class="o">&lt;</span>       # $(ANACONDA_HOME)/include/python2.7 \
<span class="o">&lt;</span>       # $(ANACONDA_HOME)/lib/python2.7/site-packages/numpy/core/include
<span class="gd">---</span>
<span class="o">&gt;</span> ANACONDA_HOME := $(HOME)/anaconda3/envs/tf
<span class="o">&gt;</span> PYTHON_INCLUDE := $(ANACONDA_HOME)/include \
<span class="o">&gt;</span>       $(ANACONDA_HOME)/include/python3.6m \
<span class="o">&gt;</span>       $(ANACONDA_HOME)/lib/python3.6/site-packages/numpy/core/include
83,84c83,84
<span class="o">&lt;</span> PYTHON_LIB := /usr/lib
<span class="o">&lt;</span> # PYTHON_LIB := $(ANACONDA_HOME)/lib
<span class="gd">---</span>
<span class="o">&gt;</span> # PYTHON_LIB := /usr/lib
<span class="o">&gt;</span> PYTHON_LIB := $(ANACONDA_HOME)/lib
94c94
<span class="o">&lt;</span> INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include
<span class="gd">---</span>
<span class="o">&gt;</span> INCLUDE_DIRS := $(PYTHON_INCLUDE)
</pre></div>


<p>Caffe can now be compiled:</p>
<div class="sh-highlight">
<div class="highlight"><pre><span></span><span class="hll">make all
</span><span class="hll">make pycaffe
</span></pre></div>


</div>


    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'cityofwings';
                var disqus_identifier = 'blog/2017/10/23/install-tensorflow-and-caffe-on-ubuntu.html';
                var disqus_url = 'https://city.shaform.com/en/blog/2017/10/23/install-tensorflow-and-caffe-on-ubuntu.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://city.shaform.com/en/archives.html">Archives</a></li>
                            <li><a href="https://city.shaform.com/en/tags.html">Tags</a></li>
                            <li><a href="https://city.shaform.com/en/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed (en)</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="https://github.com/shaform" target="_blank">GitHub</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="https://shaform.com" target="_blank">About me</a></li>
                            <li><a href="https://shaform.wordpress.com" target="_blank">一座島</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; shaform 2010-2018</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>