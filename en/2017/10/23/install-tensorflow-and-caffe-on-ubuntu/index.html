<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta name="generator" content="Hugo 0.117.0" />
  <meta charset="utf-8">
  <title>Install TensorFlow and Caffe on Ubuntu 16.04 with Anaconda · City of Wings</title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Previously I have written about 在Ubuntu 安裝 TensorFlow 的紀錄 (Installing TensorFlow on Ubuntu). Years have passed, and even though Ubuntu is still on 16.04，TensorFlow has already made great progress. I&amp;rsquo;ve decided to write another post to show how to install TensorFlow and Caffe with Anaconda. GPU" />

  <meta name="keywords" content="Shaform, open source, Python, machine learning, software" />

<link rel="canonical" href="https://city.shaform.com/en/2017/10/23/install-tensorflow-and-caffe-on-ubuntu/" />
<link rel="icon" href="https://city.shaform.com/favicon.ico" />
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<link rel="stylesheet" href="https://city.shaform.com/css/den.css">




<meta property="og:title" content="Install TensorFlow and Caffe on Ubuntu 16.04 with Anaconda" />
<meta property="og:description" content="Previously I have written about 在Ubuntu 安裝 TensorFlow 的紀錄 (Installing TensorFlow on Ubuntu). Years have passed, and even though Ubuntu is still on 16.04，TensorFlow has already made great progress. I&rsquo;ve decided to write another post to show how to install TensorFlow and Caffe with Anaconda. GPU" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://city.shaform.com/en/2017/10/23/install-tensorflow-and-caffe-on-ubuntu/" /><meta property="og:image" content="https://city.shaform.com/images/2016/notebook-hero-workspace-minimal.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-10-23T21:30:00+08:00" />
<meta property="article:modified_time" content="2017-10-23T21:30:00+08:00" />
<meta itemprop="name" content="Install TensorFlow and Caffe on Ubuntu 16.04 with Anaconda">
<meta itemprop="description" content="Previously I have written about 在Ubuntu 安裝 TensorFlow 的紀錄 (Installing TensorFlow on Ubuntu). Years have passed, and even though Ubuntu is still on 16.04，TensorFlow has already made great progress. I&rsquo;ve decided to write another post to show how to install TensorFlow and Caffe with Anaconda. GPU"><meta itemprop="datePublished" content="2017-10-23T21:30:00+08:00" />
<meta itemprop="dateModified" content="2017-10-23T21:30:00+08:00" />
<meta itemprop="wordCount" content="497"><meta itemprop="image" content="https://city.shaform.com/images/2016/notebook-hero-workspace-minimal.jpg">
<meta itemprop="keywords" content="TensorFlow,Caffe,CUDA,Ubuntu," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://city.shaform.com/images/2016/notebook-hero-workspace-minimal.jpg"/>

<meta name="twitter:title" content="Install TensorFlow and Caffe on Ubuntu 16.04 with Anaconda"/>
<meta name="twitter:description" content="Previously I have written about 在Ubuntu 安裝 TensorFlow 的紀錄 (Installing TensorFlow on Ubuntu). Years have passed, and even though Ubuntu is still on 16.04，TensorFlow has already made great progress. I&rsquo;ve decided to write another post to show how to install TensorFlow and Caffe with Anaconda. GPU"/>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-VWBX0RBP1F"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-VWBX0RBP1F', { 'anonymize_ip': false });
}
</script>
</head>
<body>
  
  <div class="header-container" style="background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url('https://city.shaform.com/images/background.jpg'); background-position: center; background-size: cover;">
  <div class="container">
  <nav class="header-nav navbar navbar-expand-md navbar-dark light-dark">
    <div class="header-logo navbar-brand">
      
        <a class="float-left" href="https://city.shaform.com/en/">
      
        
        <img class="mr20 header-logo-image" src="https://city.shaform.com/images/fly.png" alt="logo">
        
        
          City of Wings
         
      </a>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="nav-menu collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://city.shaform.com/en/category/ideas/">Ideas</a>
              
            
          </li>
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://city.shaform.com/en/category/notes/">Notes</a>
              
            
          </li>
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://city.shaform.com/en/category/projects/">Projects</a>
              
            
          </li>
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://www.google.com/search?q=site:city.shaform.com">Search</a>
              
            
          </li>
        
        
          
            <li class="nav-item">
              <a class="nav-link" href="https://city.shaform.com/zh/"><i class="fas fa-globe"></i> 繁體中文</a>
            </li>
          
          
          
          
        
      </ul>
    </div>
  </nav>
</div>

<div class="container header-wrapper">
  <div class="row">
    <div class="col-lg-12">
      <div class="header-content">
        <h1 class="header-title">Install TensorFlow and Caffe on Ubuntu 16.04 with Anaconda</h1>
        <p class="header-date">
        Mon 23 October 2017
          / In categories
          <a href="https://city.shaform.com/en/category/notes/">Notes</a>
        </p>
        
        <div class="header-underline"></div>
        
          <div class="clearfix"></div>
          <p class="float-right header-tags">
              <i class="fas fa-tags" aria-hidden="true"></i>
              <a href="https://city.shaform.com/en/tag/caffe/">Caffe</a>, 
                <a href="https://city.shaform.com/en/tag/cuda/">CUDA</a>, 
                <a href="https://city.shaform.com/en/tag/tensorflow/">TensorFlow</a>, 
                <a href="https://city.shaform.com/en/tag/ubuntu/">Ubuntu</a>
          </p>
        
        

      </div>
    </div>
  </div>
</div>

  </div>
  <main>
<div class="container content">
  <article>
  <p>Previously I have written about <a href="/zh/2016/10/31/install-tensorflow-with-cuda/">在Ubuntu 安裝 TensorFlow 的紀錄 (Installing
TensorFlow on Ubuntu)</a>.  Years have passed, and even though
Ubuntu is still on 16.04，TensorFlow has already made great progress.  I&rsquo;ve
decided to write another post to show how to install TensorFlow and Caffe with
Anaconda.</p>
<h2 id="gpu-settings">GPU Settings</h2>
<h3 id="basic">Basic</h3>
<p>Firstly set integrated video card as the main GPU in the BIOS, and connect your
monitor to the output port of the integrated video card so your Nvidia GPU is
completely dedicated to deep learning computation.</p>
<h3 id="install-cuda">Install CUDA</h3>
<p>Afterwards, download the deb files from <a href="https://developer.nvidia.com/cuda-downloads">the download page of
CUDA</a>.  Do not install at this time. We would reboot Ubuntu and
enter <code>Ctrl-Alt-F1</code> to login via terminal.</p>
<p>Execute the following command to stop <code>lightdm</code>.</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl">sudo service lightdm stop</span></span></code></pre></div></div>

<p>According to <a href="https://gist.github.com/bearpaw/c38ef18ec45ba6548ec0">this article</a>, this must be done when you want to
use your Nvidia GPU solely for CUDA. When this is not done, we might not be
able to login to the desktop after CUDA installation.</p>
<p>So now we would install CUDA 8.0.</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl">sudo dpkg -i cuda-repo-&lt;distro&gt;_&lt;version&gt;_&lt;architecture&gt;.deb
</span></span><span class="line hl"><span class="cl">sudo apt update
</span></span><span class="line hl"><span class="cl">sudo apt install cuda-8-0</span></span></code></pre></div></div>

<p>Record which version of nvidia driver is installed and add the PATH to <code>.bashrc</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64:/usr/lib/nvidia-384
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CUDA_HOME</span><span class="o">=</span>/usr/local/cuda
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/cuda/bin
</span></span></code></pre></div><p>where <code>/usr/lib/nvidia-384</code> should point to the actual version installed.</p>
<p>Reboot again to confirm that we could login:</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl">sudo reboot</span></span></code></pre></div></div>

<h2 id="setup-anaconda-environment">Setup Anaconda Environment</h2>
<h3 id="install-anaconda">Install Anaconda</h3>
<p>Download Python 3 version of Anaconda at the <a href="https://www.anaconda.com/download/#linux">Anaconda download
page</a>, and execute the installation command:</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl">bash ~/Downloads/Anaconda3-<span class="o">{</span>VERSION<span class="o">}</span>-Linux-x86_64.sh</span></span></code></pre></div></div>

<p>Install Anaconda onto a directory such as <code>$HOME/anaconda3</code>.</p>
<h3 id="create-tensorflow-environment">Create TensorFlow Environment</h3>
<p>Activate Anaconda:</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl"><span class="nb">source</span> <span class="nv">$HOME</span>/anaconda3/bin/activate</span></span></code></pre></div></div>

<p>And create a new environment named <code>tf</code>:</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl">conda create -n tf anaconda</span></span></code></pre></div></div>

<p>Finally activate <code>tf</code> environment:</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl"><span class="nb">source</span> activate tf</span></span></code></pre></div></div>

<h2 id="install-tensorflow">Install TensorFlow</h2>
<p>Execute this command and <code>tensorflow-gpu</code>, <code>cudnn</code>, <code>cudatoolkit</code> would be
installed automatically.</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl">conda install tensorflow-gpu</span></span></code></pre></div></div>

<h2 id="install-caffe">Install Caffe</h2>
<p>Firstly install the required packages:</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl">sudo apt install build-essential
</span></span><span class="line hl"><span class="cl">conda install atlas boost gflags glog hdf5 leveldb lmdb openblas protobuf
</span></span><span class="line hl"><span class="cl">conda install -c menpo opencv3</span></span></code></pre></div></div>

<p>Download Caffe, and create the configuration file.</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl">git clone https://github.com/BVLC/caffe
</span></span><span class="line hl"><span class="cl"><span class="nb">cd</span> caffe
</span></span><span class="line hl"><span class="cl">cp Makefile.config.example Makefile.config</span></span></code></pre></div></div>

<p>Modify <code>Makefile.config</code>, the number in <code>python3.6</code> could be
changed to the current Python version:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gu">5c5
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gd">&lt; # USE_CUDNN := 1
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gs">---
</span></span></span><span class="line"><span class="cl"><span class="gs"></span><span class="gi">&gt; USE_CUDNN := 1
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gu">21c21
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gd">&lt; # OPENCV_VERSION := 3
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gs">---
</span></span></span><span class="line"><span class="cl"><span class="gs"></span><span class="gi">&gt; OPENCV_VERSION := 3
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gu">25c25
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gd">&lt; # CUSTOM_CXX := g++
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gs">---
</span></span></span><span class="line"><span class="cl"><span class="gs"></span><span class="gi">&gt; CUSTOM_CXX := /usr/bin/g++-4.9
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gu">68,69c68,69
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gd">&lt; PYTHON_INCLUDE := /usr/include/python2.7 \
</span></span></span><span class="line"><span class="cl"><span class="gd">&lt;       /usr/lib/python2.7/dist-packages/numpy/core/include
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gs">---
</span></span></span><span class="line"><span class="cl"><span class="gs"></span><span class="gi">&gt; # PYTHON_INCLUDE := /usr/include/python2.7 \
</span></span></span><span class="line"><span class="cl"><span class="gi">&gt; #         /usr/lib/python2.7/dist-packages/numpy/core/include
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gu">72,75c72,75
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gd">&lt; # ANACONDA_HOME := $(HOME)/anaconda
</span></span></span><span class="line"><span class="cl"><span class="gd">&lt; # PYTHON_INCLUDE := $(ANACONDA_HOME)/include \
</span></span></span><span class="line"><span class="cl"><span class="gd">&lt;       # $(ANACONDA_HOME)/include/python2.7 \
</span></span></span><span class="line"><span class="cl"><span class="gd">&lt;       # $(ANACONDA_HOME)/lib/python2.7/site-packages/numpy/core/include
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gs">---
</span></span></span><span class="line"><span class="cl"><span class="gs"></span><span class="gi">&gt; ANACONDA_HOME := $(HOME)/anaconda3/envs/tf
</span></span></span><span class="line"><span class="cl"><span class="gi">&gt; PYTHON_INCLUDE := $(ANACONDA_HOME)/include \
</span></span></span><span class="line"><span class="cl"><span class="gi">&gt;       $(ANACONDA_HOME)/include/python3.6m \
</span></span></span><span class="line"><span class="cl"><span class="gi">&gt;       $(ANACONDA_HOME)/lib/python3.6/site-packages/numpy/core/include
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gu">83,84c83,84
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gd">&lt; PYTHON_LIB := /usr/lib
</span></span></span><span class="line"><span class="cl"><span class="gd">&lt; # PYTHON_LIB := $(ANACONDA_HOME)/lib
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gs">---
</span></span></span><span class="line"><span class="cl"><span class="gs"></span><span class="gi">&gt; # PYTHON_LIB := /usr/lib
</span></span></span><span class="line"><span class="cl"><span class="gi">&gt; PYTHON_LIB := $(ANACONDA_HOME)/lib
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gu">94c94
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gd">&lt; INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gs">---
</span></span></span><span class="line"><span class="cl"><span class="gs"></span><span class="gi">&gt; INCLUDE_DIRS := $(PYTHON_INCLUDE)
</span></span></span></code></pre></div><p>Caffe can now be compiled:</p>
<div class="sh-highlight"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line hl"><span class="cl">make all
</span></span><span class="line hl"><span class="cl">make pycaffe</span></span></code></pre></div></div>


<link rel="stylesheet" href="https://city.shaform.com/css/hugo-easy-gallery.css" />
<div class="box aligncenter">
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img class="webfeedsFeaturedVisual" itemprop="thumbnail" src="/images/2016/notebook-hero-workspace-minimal.jpg" alt="Notebook" />
    </div>
    
  </figure>
</div>


  </article>

  
  
    
  
  
<div class="disqus-comment">
<div>
<div class="comment-underline"></div>
</div>
<div class="btn btn-secondary disqus-button" id="load_disqus" onclick="load_disqus()">
  Load Disqus Comments
</div>
<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = "https://city.shaform.com/en/2017/10/23/install-tensorflow-and-caffe-on-ubuntu/";
  };
  function load_disqus() {
    
    
    if (window.location.hostname === 'localhost') return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'cityofwings';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    dsq.setAttribute('data-timestamp', +new Date());
    (document.head || document.body).appendChild(dsq);

    $('#load_disqus').remove();
  };
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

</div>


</div>

  </main><div class="footer gradient-2">
  <div class="container footer-container ">
    <div class="row">
      <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
        <div class="footer-title">Sitemap</div>
        <ul class="list-unstyled">
            
              
                <li><a href="https://city.shaform.com/en/tags/">Tags</a></li>
              
              
                <li><a href="https://city.shaform.com/en/categories/">Categories</a></li>
              
            
            
            
            <li><a rel="alternate" type="application/rss&#43;xml" href="https://city.shaform.com/en/index.xml"><i class="fas fa-rss-square"></i> RSS Feed</a></li>
            
            
            
              
                <li><a type="application/rss+xml" href="https://city.shaform.com/feeds/all.atom.xml"><i class="fas fa-rss-square"></i> RSS Feed (en&#43;zh)</a></li>
              
            
        </ul>
      </div>
      <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
        
      </div>
      <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
        
        <div class="footer-title">Links</div>
        <ul class="list-unstyled">
          
          <li><a href="https://shaform.com/" rel="noopener" target="_blank">About Me</a></li>
          
          <li><a href="https://island.shaform.com/en/" rel="noopener" target="_blank">An Island</a></li>
          
        </ul>
        
      </div> 
      <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
        <p class="pull-right text-right">
          <small><em>Proudly powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo</a></em></small><br/>
          <small><em>Theme - <a href="https://github.com/shaform/hugo-theme-den" rel="noopener" target="_blank">Den</a></em></small><br/>
          <small>
            &copy; 
            Shaform
            
              2010 -
            2023
          </small>
          
        </p>
      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script>
$(document).ready(function() {
  if ($('#load_disqus').length) {
    $(window).scroll(function() {
      if ($('#load_disqus').length) {
        var elementTop = $('#load_disqus').offset().top;
        var viewportTop = $(window).scrollTop();
        var viewportBottom = viewportTop + $(window).height();
        if (viewportTop < elementTop && elementTop < viewportBottom) {
          load_disqus();
        }
      }
    });
  }
});
</script>

</body>
</html>
